- name: appsetup for catalogue by using import role
  ansible.builtin.import_role:
        name: common
        tasks_from: appsetup.yaml

- name: installing nodejs dependencies
  ansible.builtin.import_role:
        name: common
        tasks_from: nodejs.yaml


- name: systemsetup
  ansible.builtin.import_role:
        name: common
        tasks_from: systemsetup.yaml


- name: copying mongo.repo file to /etc/yum.repos.d/mongo.repo
  ansible.builtin.copy:
      src: mongo.repo
      dest: /etc/yum.repos.d/mongo.repo 

- name: install mongodb client
  ansible.builtin.package:
      name: mongodb-mongosh
      state: present  

- name: connect to mongodb client
  ansible.builtin.command: mongosh mongodb.mitha.fun --quiet --eval "db.getMongo().getDBNames().indexOf('catalogue')"
  register: catalogue_output
  failed_when: false


- name: print catalogue ec2_output
  ansible.builtin.debug:
      msg: "{{ catalogue_output }}"

- name: load products into mongodb
  ansible.builtin.shell: mongosh --host {{ MONGODB }} </app/db/master-data.js
  when: catalogue_output.stdout | int <